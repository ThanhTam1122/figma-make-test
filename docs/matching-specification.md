# マッチング機能 仕様書

## 概要
きらりライフサポート（家事代行サービス）のマッチング機能に関する仕様書です。
ユーザーが募集を投稿し、きらりさん（サポーター）が応募し、マッチングが成立するまでのフローを定義しています。

---

## 1. 画面構成

### 1.1 マッチング詳細画面
**パス**: `/src/app/components/matching/matching-detail-page.tsx`

#### 機能概要
- 募集内容の詳細表示
- 応募者リストの管理
- 応募の承認・お断り機能

#### 表示内容

**依頼内容サマリー**
- 依頼種別（定期/スポット）
- 募集ステータス
- 日時・時間
- 住所・最寄り駅
- サービス内容（料理、掃除など）

**応募状況サマリー**
- 総応募件数
- 未対応件数

**応募者リスト（未対応）**
各応募者について以下を表示：
- 基本情報：名前、年齢、性別
- 応募メッセージ
- 応募日
- アクションボタン：
  - 「メッセージ」ボタン → 個別メッセージ画面へ遷移
  - 「プロフィール」ボタン（テキストリンク）→ きらりさんプロフィール画面へ遷移
  - 「×」ボタン → お断り確認ダイアログ表示
  - 「承認」ボタン → 承認確認ダイアログ表示

**承認済み・お断り済みセクション（折りたたみ）**
- 承認済み応募者リスト（緑背景）
- お断り済み応募者リスト（グレー背景）

#### 確認ダイアログ仕様

**承認確認ダイアログ**
- タイトル：「応募を承諾しますか？」
- メッセージ：「〇〇さんの応募を承諾します。この操作は取り消せません。」
- ボタン：
  - 「キャンセル」（白背景）
  - 「承諾する」（オレンジ背景）

**お断り確認ダイアログ**
- タイトル：「お断りしますか？」
- メッセージ：「〇〇さんの応募をお断りします。この操作は取り消せません。」
- メッセージ入力欄（任意）：
  - ラベル：「メッセージ（任意）」
  - プレースホルダー：「お断りの理由をお伝えすることができます」
  - 行数：4行
  - 注意書き：「※ 入力したメッセージは応募者に送信されます」
- ボタン：
  - 「キャンセル」（白背景）
  - 「お断りする」（赤背景）

---

### 1.2 きらりさんプロフィール画面
**パス**: `/src/app/components/matching/supporter-profile-page.tsx`

#### 機能概要
応募者（きらりさん）の詳細プロフィール情報を表示

#### 表示内容
- 基本情報
  - 名前、年齢、性別
  - プロフィール画像（アバター）
  - 評価（星評価）、レビュー件数
  - 経験年数
  
- 自己紹介文

- スキル・得意分野
  - 対応可能なサービス（料理、掃除、洗濯など）
  - 特記事項

- 稼働情報
  - 対応可能エリア
  - 対応可能曜日・時間帯
  - 最寄り駅からの距離

- レビュー
  - 過去の利用者からの評価・コメント

#### アクション
- 「戻る」ボタン：前の画面に戻る
- 「メッセージを送る」ボタン：個別メッセージ画面へ遷移

---

### 1.3 応募者との個別メッセージ画面
**パス**: `/src/app/components/matching/applicant-message-page.tsx`

#### 機能概要
特定の応募者との1対1メッセージのやり取り（チャットタブとは別機能）

#### 表示内容

**ヘッダー**
- 戻るボタン
- 応募者名、年齢、性別
- 「プロフィール」ボタン（小）

**区切りバー**
- 「応募に関するメッセージ」の表記（オレンジ背景）

**メッセージ一覧**
- 応募者からのメッセージ：左寄せ、白背景
- 自分のメッセージ：右寄せ、オレンジ背景
- 各メッセージに送信日時を表示

**メッセージ入力エリア**
- 入力フィールド（丸角）
- 送信ボタン（丸型、オレンジ）
- 注意書き：「※ マッチング成立前のやり取りです。個人情報の交換はお控えください。」

#### 操作
- テキスト入力後、送信ボタンまたはEnterキーでメッセージ送信
- 「プロフィール」ボタンでプロフィール画面へ遷移
- 「戻る」ボタンでマッチング詳細画面へ戻る

---

## 2. 画面遷移フロー

```
マッチング詳細画面
  ├─ 応募者の「メッセージ」ボタン
  │    → 個別メッセージ画面
  │         ├─ 「プロフィール」ボタン → きらりさんプロフィール画面
  │         └─ 「戻る」ボタン → マッチング詳細画面
  │
  ├─ 応募者の「プロフィール」リンク
  │    → きらりさんプロフィール画面
  │         ├─ 「メッセージを送る」ボタン → 個別メッセージ画面
  │         └─ 「戻る」ボタン → マッチング詳細画面
  │
  ├─ 「×」ボタン → お断り確認ダイアログ
  │    ├─ 「キャンセル」→ ダイアログを閉じる
  │    └─ 「お断りする」→ 応募をお断り → お断り済みセクションへ移動
  │
  └─ 「承認」ボタン → 承認確認ダイアログ
       ├─ 「キャンセル」→ ダイアログを閉じる
       └─ 「承諾する」→ 応募を承認 → 承認済みセクションへ移動
```

---

## 3. データ構造

### 3.1 応募者（Applicant）

```typescript
interface Applicant {
  id: string;                    // 応募者ID
  name: string;                  // 名前
  age: number;                   // 年齢
  gender: string;                // 性別
  rating: number;                // 評価（0-5）
  reviewCount: number;           // レビュー件数
  experience: string;            // 経験年数
  message: string;               // 応募メッセージ
  appliedDate: string;           // 応募日
  status: ApplicantStatus;       // ステータス
  distance: string;              // 距離
  availability: string[];        // 対応可能時間帯
}

type ApplicantStatus = 'pending' | 'approved' | 'rejected';
```

### 3.2 依頼内容（Job）

```typescript
interface Job {
  id: string;                    // 依頼ID
  jobNumber: string;             // 依頼番号
  jobType: 'regular' | 'spot';   // 定期/スポット
  spotDate?: string;             // スポット利用日
  spotTime?: string;             // スポット利用時間
  services: string[];            // サービス内容
  address: string;               // 住所
  nearestStation: string;        // 最寄り駅
  createdDate: string;           // 作成日
  status: string;                // ステータス
}
```

---

## 4. デザイン仕様

### 4.1 カラースキーム
- **プライマリカラー**：オレンジ（`bg-primary`, `text-primary`）
- **アクセント**：白ベース + オレンジアクセント
- **ステータス色**：
  - 定期：青（`bg-blue-100`, `text-blue-700`）
  - スポット：オレンジ（`bg-orange-100`, `text-orange-700`）
  - 募集中：緑（`bg-green-100`, `text-green-700`）
  - 承認済み：緑背景（`bg-green-50`）
  - お断り済み：グレー背景（`bg-gray-50`）
  - お断りボタン：赤（`bg-red-600`）

### 4.2 レイアウト
- **モバイル優先デザイン**
- 画面下部に固定タブナビゲーション（ホーム・予約・チャット・メニュー）
- スティッキーヘッダー
- カード型UI

### 4.3 アイコン
lucide-reactを使用
- ArrowLeft：戻る
- MapPin：場所
- Calendar：日付
- Clock：時間
- User：ユーザー/プロフィール
- MessageCircle：メッセージ
- CheckCircle：承認
- X：お断り/閉じる
- Send：送信
- ChevronRight：展開

---

## 5. 用語統一

| 用語 | 説明 |
|------|------|
| きらりさん | サポーター（家事代行スタッフ）の呼称 |
| ユーザー | サービス利用者（依頼者） |
| 定期 | 定期利用の依頼 |
| スポット | 単発利用の依頼 |
| マッチング | ユーザーときらりさんのマッチング |
| 応募 | きらりさんからの応募 |
| 承認 | ユーザーが応募を承諾すること |
| チャット | 全体的なチャット機能（タブナビゲーション） |
| メッセージ | 応募に関する個別やり取り |

---

## 6. 注意事項

### 6.1 個人情報の取り扱い
- マッチング成立前は個人情報の交換を禁止
- メッセージ入力エリアに注意書きを表示

### 6.2 操作の不可逆性
- 承認・お断りの操作は取り消し不可
- 確認ダイアログで明示的に警告

### 6.3 メッセージの分離
- 応募に関するメッセージ：個別メッセージ画面
- 一般的なチャット：チャットタブ
- 両者は完全に別の機能として実装

---

## 7. 実装ファイル一覧

| ファイルパス | 説明 |
|-------------|------|
| `/src/app/components/matching/matching-detail-page.tsx` | マッチング詳細画面 |
| `/src/app/components/matching/supporter-profile-page.tsx` | きらりさんプロフィール画面 |
| `/src/app/components/matching/applicant-message-page.tsx` | 応募者との個別メッセージ画面 |
| `/src/app/App.tsx` | ルーティング設定 |

---

## 8. 今後の拡張予定
- マッチング成立後の機能
- スケジュール調整機能との連携
- レビュー・評価機能
- 通知機能との連携

---

**作成日**: 2026年2月3日  
**バージョン**: 1.0  
**最終更新**: 2026年2月3日
